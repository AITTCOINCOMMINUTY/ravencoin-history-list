{"mappings":"AAAA,2BAA2B,MAAM,EAAE,MAAM,EAAE,GAAG,YAAY,EAAE,CAa3D;AA+DD;IACE,SAAS,EAAE,MAAM,CAAC;IAClB,QAAQ,EAAE,MAAM,CAAC;IACjB,IAAI,EAAE,MAAM,CAAC;IACb,KAAK,EAAE,MAAM,CAAC;IACd,UAAU,EAAE,MAAM,CAAC;IACnB,MAAM,EAAE,MAAM,CAAC;IACf,OAAO,EAAE,MAAM,CAAC;CACjB;AAED;IACE,SAAS,EAAE,MAAM,CAAC;IAClB,KAAK,EAAE,MAAM,CAAC;IACd,QAAQ,EAAE,MAAM,CAAC;CAClB;AACD;IACE,MAAM,EAAE,OAAO,CAAC;IAChB,MAAM,EAAE,gBAAgB,EAAE,CAAC;IAC3B,WAAW,EAAE,MAAM,CAAC;IACpB,aAAa,EAAE,MAAM,CAAC;CACvB;;;;AACD,wBAEE","sources":["index.ts"],"sourcesContent":["export function getHistory(deltas: IDelta[]): IHistoryItem[] {\r\n  const deltasByTransactionId = getDeltasMappedToTransactionId(deltas);\r\n  const history = Array.from(deltasByTransactionId.values()).map(getListItem);\r\n  history.sort((h1, h2) => {\r\n    if (h1.blockHeight > h2.blockHeight) {\r\n      return -1;\r\n    }\r\n    if (h2.blockHeight > h1.blockHeight) {\r\n      return 1;\r\n    }\r\n    return 0;\r\n  });\r\n  return history;\r\n}\r\n\r\n/**\r\n *\r\n * @param deltas Address deltas from the same transaction\r\n */\r\nfunction getListItem(deltas: IDelta[]): IHistoryItem {\r\n  //Very simple if only one delta, like you received two LEMONADE tokens\r\n  if (deltas.length === 1) {\r\n    const delta = deltas[0];\r\n    const item: IHistoryItem = {\r\n      isSent: delta.satoshis < 0,\r\n      assets: [\r\n        {\r\n          assetName: delta.assetName,\r\n          value: delta.satoshis / 1e8,\r\n          satoshis: delta.satoshis,\r\n        },\r\n      ],\r\n      blockHeight: delta.height,\r\n      transactionId: delta.txid,\r\n    };\r\n    return item;\r\n  } else {\r\n    const temp = {};\r\n    deltas.map((delta) => {\r\n      temp[delta.assetName] = temp[delta.assetName] || 0;\r\n      temp[delta.assetName] += delta.satoshis;\r\n    });\r\n\r\n    let isSent = false;\r\n    const assets: INeedABetterName[] = Object.keys(temp).map((name) => {\r\n      //If any of the values is negative, it means we have sent\r\n      if (temp[name] < 0) {\r\n        isSent = true;\r\n      }\r\n\r\n      const obj = {\r\n        assetName: name,\r\n        satoshis: temp[name],\r\n        value: temp[name] / 1e8,\r\n      };\r\n      return obj;\r\n    });\r\n\r\n    const listItem: IHistoryItem = {\r\n      assets,\r\n      blockHeight: deltas[0].height,\r\n      transactionId: deltas[0].txid,\r\n      isSent,\r\n    };\r\n    return listItem;\r\n  }\r\n}\r\nfunction getDeltasMappedToTransactionId(deltas: IDelta[]) {\r\n  const map: Map<string, IDelta[]> = new Map();\r\n  deltas.map((delta) => {\r\n    const arr: IDelta[] = map.get(delta.txid) || [];\r\n    arr.push(delta);\r\n    map.set(delta.txid, arr);\r\n  });\r\n  return map;\r\n}\r\nexport interface IDelta {\r\n  assetName: string;\r\n  satoshis: number;\r\n  txid: string;\r\n  index: number;\r\n  blockindex: number;\r\n  height: number;\r\n  address: string;\r\n}\r\n\r\ninterface INeedABetterName {\r\n  assetName: string;\r\n  value: number;\r\n  satoshis: number;\r\n}\r\nexport interface IHistoryItem {\r\n  isSent: boolean;\r\n  assets: INeedABetterName[];\r\n  blockHeight: number;\r\n  transactionId: string;\r\n}\r\nexport default {\r\n  getHistory,\r\n};\r\n"],"names":[],"version":3,"file":"types.d.ts.map"}